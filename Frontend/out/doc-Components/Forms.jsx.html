<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Forms.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Forms.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { yupResolver } from '@hookform/resolvers/yup';
import * as Yup from 'yup';
import { useSelector, useDispatch } from 'react-redux';
import { useNavigate, useLocation } from 'react-router-dom';
import { addNewUser, updateUser } from '../features/user/usersSlice';
import { FormControl, FormLabel, RadioGroup, FormControlLabel, Radio, Input, InputAdornment, IconButton } from '@mui/material';
import ButtonSubmit from "./ButtonSubmit";
import styles from "./Forms.module.css";
import Visibility from '@mui/icons-material/Visibility';
import VisibilityOff from '@mui/icons-material/VisibilityOff'; 

// Esquema de validação com Yup
const validationSchema = Yup.object().shape({
  nome: Yup.string().required('Nome é obrigatório'),
  cpf: Yup.string().required('CPF é obrigatório').matches(/^\d{3}\.\d{3}\.\d{3}-\d{2}$/, 'Formato de CPF inválido'),
  email: Yup.string().email('Email inválido').required('Email é obrigatório'),
  senha: Yup.string().when('$isEditMode', { // Validação condicional da senha
    is: false,
    then: schema => schema.min(6, 'A senha deve ter pelo menos 6 caracteres').required('Senha é obrigatória'),
    otherwise: schema => schema.optional(),
  }),
  cargo: Yup.string().required('Perfil é obrigatório'),
});

/**
 * Componente de formulário para Criar ou Editar um Perfil de Usuário.
 *
 * Utiliza `react-hook-form` para gerenciamento de estado e `yup` para validação.
 * Detecta automaticamente o modo (Criação vs. Edição) com base na URL.
 * Despacha ações do Redux (`addNewUser` ou `updateUser`) ao submeter.
 *
 * @returns {JSX.Element} O formulário de usuário.
 */
export default function Forms() {
  const [showSenha, setShowSenha] = useState(false); // Estado para mostrar/ocultar senha
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const location = useLocation();

  // Verifica se está em modo de edição pela URL
  const isEditMode = location.pathname.includes('/perfil/editar');
  const { currentUser } = useSelector(state => state.login);

  // Configuração do React Hook Form
  const { register, handleSubmit, formState: { errors, isSubmitting }, setValue } = useForm({
    resolver: yupResolver(validationSchema),
    context: { isEditMode }, 
    defaultValues: isEditMode ? currentUser : { cargo: 'funcionario' } // Define valores padrão
  });

  // Máscara para o campo de CPF
  const handleCpfChange = (e) => {
    let v = e.target.value.replace(/\D/g, "").slice(0, 11);
    if (v.length > 9) v = v.replace(/^(\d{3})(\d{3})(\d{3})(\d{0,2}).*/, "$1.$2.$3-$4");
    else if (v.length > 6) v = v.replace(/^(\d{3})(\d{3})(\d{0,3}).*/, "$1.$2.$3");
    else if (v.length > 3) v = v.replace(/^(\d{3})(\d{0,3}).*/, "$1.$2");
    setValue('cpf', v, { shouldValidate: true });
  };

  // Alterna a visibilidade da senha
  const handleClickShowSenha = () => { 
    setShowSenha((show) => !show);
  };

  // Função de submit (Criação ou Edição)
 const onSubmit = async (data) => {
    try {
      if (isEditMode) {
        // Lógica de edição
        await dispatch(updateUser({ ...currentUser, ...data })).unwrap();
        alert('Perfil atualizado com sucesso!');
        navigate('/perfil');
      } else {
        // Lógica de criação
        await dispatch(addNewUser(data)).unwrap();
        alert('Conta criada com sucesso!');
        navigate('/login');
      }
    } catch (err) {
      alert('Ocorreu uma falha ao salvar os dados.');
      console.error('Falha ao salvar:', err);
    }
  };

  // Renderização do formulário
  return (
    &lt;form onSubmit={handleSubmit(onSubmit)} className={styles.loginForm}>
      
      &lt;div className="form-group">
        &lt;label>Nome completo&lt;/label>
        &lt;Input fullWidth {...register("nome")} />
        {errors.nome &amp;&amp; &lt;p className="error-message">{errors.nome.message}&lt;/p>}
      &lt;/div>

      &lt;div className="form-group">
        &lt;label>CPF&lt;/label>
        &lt;Input fullWidth {...register("cpf")} onChange={handleCpfChange} />
        {errors.cpf &amp;&amp; &lt;p className="error-message">{errors.cpf.message}&lt;/p>}
      &lt;/div>

      &lt;div className="form-group">
        &lt;label>E-mail&lt;/label>
        &lt;Input fullWidth type="email" {...register("email")} />
        {errors.email &amp;&amp; &lt;p className="error-message">{errors.email.message}&lt;/p>}
      &lt;/div>
      
      {/* Campo de senha só aparece no modo de criação */}
      {!isEditMode &amp;&amp; (
        &lt;div className="form-group">
          &lt;label>Senha&lt;/label>
          &lt;Input 
          fullWidth 
          type={showSenha ? "text" : "password"} // Alterna o tipo
          {...register("senha")} 
          endAdornment={ // Ícone de visibilidade
              &lt;InputAdornment position="end">
                &lt;IconButton
                  aria-label="toggle password visibility"
                  onClick={handleClickShowSenha}
                  edge="end"
                >
                  {showSenha ? &lt;VisibilityOff /> : &lt;Visibility />}
                &lt;/IconButton>                
              &lt;/InputAdornment>
          }
          />
          {errors.senha &amp;&amp; &lt;p className="error-message">{errors.senha.message}&lt;/p>}
        &lt;/div>
      )}

      {/* Seleção de Cargo (Perfil) */}
      &lt;FormControl component="fieldset" style={{ marginTop: "20px" }}>
        &lt;FormLabel component="legend" style={{ fontWeight: 600, color: "#333" }}>Perfil&lt;/FormLabel>
        &lt;RadioGroup row>
          &lt;FormControlLabel value="funcionario" control={&lt;Radio {...register("cargo")} />} label="Funcionário" />
          &lt;FormControlLabel value="gestor" control={&lt;Radio {...register("cargo")} />} label="Gestor" />
        &lt;/RadioGroup>
      &lt;/FormControl>

      &lt;ButtonSubmit texto={isEditMode ? 'Salvar Alterações' : 'Criar Conta'} disabled={isSubmitting} />
    &lt;/form>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ButtonSubmit">ButtonSubmit</a></li><li><a href="global.html#CardAvaliacao">CardAvaliacao</a></li><li><a href="global.html#CardMeta">CardMeta</a></li><li><a href="global.html#CardQuestao">CardQuestao</a></li><li><a href="global.html#ListaCardAvaliacao">ListaCardAvaliacao</a></li><li><a href="global.html#ListaCardMeta">ListaCardMeta</a></li><li><a href="global.html#NavBar">NavBar</a></li><li><a href="global.html#OpcaoSlider">OpcaoSlider</a></li><li><a href="global.html#OpcoesMultiplaEscolha">OpcoesMultiplaEscolha</a></li><li><a href="global.html#PersistentDrawerRight">PersistentDrawerRight</a></li><li><a href="global.html#SimpleContainer">SimpleContainer</a></li><li><a href="global.html#formatResposta">formatResposta</a></li><li><a href="global.html#handleChange">handleChange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Nov 20 2025 12:12:08 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
